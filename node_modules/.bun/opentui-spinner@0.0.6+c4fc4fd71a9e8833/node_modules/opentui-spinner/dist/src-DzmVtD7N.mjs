import{Renderable as e,parseColor as t,resolveRenderLib as n}from"@opentui/core";import r from"cli-spinners";function i(e,t=1){return n=>e[Math.floor(n*t)%e.length]}function a(e){return(t,n,r,i)=>{let a=(n+t)%i;return e[Math.floor(a/i*e.length)]??e[0]}}var o=class extends e{_name;_frames;_interval;_autoplay;_backgroundColor;_color;_currentFrameIndex=0;_encodedFrames={};_lib=n();_intervalId=null;_defaultOptions={name:`dots`,frames:r.dots.frames,interval:r.dots.interval,autoplay:!0,backgroundColor:`transparent`,color:`white`};constructor(e,t){super(e,t),this._name=t.name,this._frames=this._name?r[this._name].frames:t.frames??this._defaultOptions.frames,this._interval=this._name?r[this._name].interval:t.interval??this._defaultOptions.interval,this._autoplay=t.autoplay??this._defaultOptions.autoplay,this._backgroundColor=t.backgroundColor??this._defaultOptions.backgroundColor,this._color=t.color??this._defaultOptions.color,this.width=Math.max(...this._frames.map(e=>e.length)),this.height=1,this._encodeFrames(),this._autoplay&&this.start()}_encodeFrames(){for(let e of this._frames){let t=this._lib.encodeUnicode(e,this.ctx.widthMethod);t&&(this._encodedFrames[e]=t)}}_freeFrames(){for(let e in this._encodedFrames)this._encodedFrames[e]&&this._lib.freeUnicode(this._encodedFrames[e]);this._encodedFrames={}}get interval(){return this._interval}set interval(e){this.stop(),this._interval=e,this.start()}get name(){return this._name}set name(e){this._freeFrames(),this._name=e,this._frames=this._name?r[this._name].frames:this._defaultOptions.frames,this._interval=this._name?r[this._name].interval:this._defaultOptions.interval,this.width=Math.max(...this._frames.map(e=>e.length)),this._encodeFrames(),this.requestRender()}get frames(){return this._frames}set frames(e){this._freeFrames(),this._frames=e.length===0?this._defaultOptions.frames:e,this._encodeFrames(),this.width=Math.max(...this._frames.map(e=>e.length)),this.requestRender()}get color(){return this._color}set color(e){this._color=e,this.requestRender()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e,this.requestRender()}start(){this._intervalId||=setInterval(()=>{this._currentFrameIndex=(this._currentFrameIndex+1)%this._frames.length,this.requestRender()},this._interval)}stop(){this._intervalId&&=(clearInterval(this._intervalId),null)}renderSelf(e){if(!this.visible)return;let n=this._frames[this._currentFrameIndex];if(!n)return;let r=this._encodedFrames[n];if(!r)return;let i=this.x;for(let n=0;n<r.data.length;n++){let a=typeof this._color==`function`?this._color(this._currentFrameIndex,n,this._frames.length,r.data.length):this._color;e.drawChar(r.data[n].char,i,this.y,t(a),t(this._backgroundColor)),i+=r.data[n].width}}destroySelf(){this.stop(),this._freeFrames(),super.destroySelf()}};export{i as n,a as r,o as t};